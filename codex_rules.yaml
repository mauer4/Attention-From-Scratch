# Auto-generated maintenance policy for Attention-From-Scratch
checks:
  triggers:
    - on_push
    - on_pull_request
    - weekly_cron
  tasks:
    - name: gpu_probe
      command: python setup_env/check_gpu.py
    - name: venv_integrity
      command: bash setup_env/create_venv.sh
    - name: dependencies
      command: bash setup_env/install_deps.sh
    - name: config
      command: python setup_env/verify_config.py
    - name: sanity_inference
      command: python scripts/test_inference.py
  expectations:
    directories:
      - setup_env
      - scripts
      - src
      - include
      - src/custom_engine
      - src/custom_engine/utils
      - src/custom_engine/v1
      - weights
      - configs
      - reports
    gitignore_entries:
      - .venv/
      - __pycache__/
      - "*.log"
      - reports/
      - "*.safetensors"
      - .env
policies:
  lockfile:
    on_requirements_change: bash setup_env/install_deps.sh
  report_retention:
    keep: 5
  archive_strays_to: legacy/
outputs:
  - reports/auto_verification.json
  - reports/auto_verification.md
  - reports/auto_verification.html
guidelines:
  custom_engine_v1_basic:
    description: >-
      The non-performant, correctness-first custom engine (v1) lives in src/custom_engine/v1
      and depends on shared utilities in src/custom_engine/util plus headers under include/.
      Logging and error-handling must route through custom_engine/utils/logging.h, CUDA work
      should use custom_engine/utils/cuda_utils.cuh, and safetensors access must go through
      custom_engine/utils/safetensors.*.
    requirements:
      - Maintain the logging/error macros so diagnostics stay uniform across host and CUDA code.
      - Keep tokenizer bridges and other adapters in src/custom_engine/v1 to separate engine
        specifics from reusable utilities.
      - Tests for shard loading (tests/test_loader.cpp) must stay in sync with codex rules to
        validate weight/index integrity.
personality: diagnostic
